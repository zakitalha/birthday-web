<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Love Story - A Nostalgic Journey</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Our Love Story: A Journey Through Time">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💖</text></svg>">
    <style>
        /* All your existing CSS remains the same, with minor optimizations for performance */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #0a0a0a;
            color: #f5f5f5;
            overflow-x: hidden;
            cursor: none;
        }

        /* Vintage film grain - optimized with will-change for smoother animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIiB4PSIwIiB5PSIwIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxwYXRoIGQ9Ik0wIDBoMzAwdjMwMEgweiIgZmlsdGVyPSJ1cmwoI2EpIiBvcGFjaXR5PSIuMDUiLz48L3N2Zz4=');
            opacity: 0.15;
            z-index: 1;
            pointer-events: none;
            animation: grain 0.5s steps(10) infinite;
            will-change: transform;
        }

        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -10%); }
            30% { transform: translate(3%, -15%); }
            50% { transform: translate(12%, 9%); }
            70% { transform: translate(9%, 4%); }
            90% { transform: translate(-1%, 7%); }
        }

        /* Vignette effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 200px rgba(0,0,0,0.9);
            z-index: 1;
            pointer-events: none;
        }

        /* Custom cursor - vintage style, hidden on mobile */
        .custom-cursor {
            width: 30px;
            height: 30px;
            border: 2px solid #d4a574;
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            transition: transform 0.15s ease;
            mix-blend-mode: difference;
            box-shadow: 0 0 15px rgba(212, 165, 116, 0.5);
            display: none; /* Hidden by default, shown via JS on desktop */
        }

        @media (min-width: 769px) {
            body { cursor: none; }
            .custom-cursor { display: block; }
        }

        .custom-cursor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: #d4a574;
            border-radius: 50%;
        }

        .custom-cursor.active {
            transform: scale(1.8);
        }

        /* Old photo frames on sides */
        .photo-frame {
            position: fixed;
            width: 120px;
            height: 150px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 8px solid #8b7355;
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.8),
                0 10px 30px rgba(0,0,0,0.8);
            z-index: 5;
            opacity: 0;
            animation: photoFadeIn 1s ease forwards;
            transform: rotate(var(--rotation));
            will-change: opacity, transform;
        }

        .photo-frame::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 2px solid rgba(212, 165, 116, 0.3);
        }

        .frame-left-1 { left: 30px; top: 15%; --rotation: -5deg; animation-delay: 0.5s; }
        .frame-left-2 { left: 50px; top: 45%; --rotation: 3deg; animation-delay: 0.8s; }
        .frame-left-3 { left: 20px; top: 70%; --rotation: -4deg; animation-delay: 1.1s; }
        .frame-right-1 { right: 30px; top: 20%; --rotation: 4deg; animation-delay: 0.6s; }
        .frame-right-2 { right: 45px; top: 50%; --rotation: -3deg; animation-delay: 0.9s; }
        .frame-right-3 { right: 35px; top: 75%; --rotation: 5deg; animation-delay: 1.2s; }

        @keyframes photoFadeIn {
            to { opacity: 0.4; }
        }

        /* Opening scene - vintage camera style */
        .opening-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: 
                radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.8) 100%),
                linear-gradient(135deg, #2c1810 0%, #1a0f08 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1.5s ease;
        }

        .opening-scene::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 4px
            );
            animation: scanlines 8s linear infinite;
            will-change: transform;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        .opening-scene.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .opening-title {
            font-size: 5rem;
            font-weight: 400;
            text-align: center;
            margin-bottom: 1rem;
            opacity: 0;
            animation: fadeInUp 2s ease forwards;
            color: #d4a574;
            text-shadow: 
                0 0 20px rgba(212, 165, 116, 0.8),
                0 0 40px rgba(212, 165, 116, 0.5),
                2px 2px 4px rgba(0,0,0,0.8);
            font-family: 'Georgia', serif;
            letter-spacing: 4px;
        }

        .opening-subtitle {
            font-size: 1.8rem;
            opacity: 0;
            animation: fadeInUp 2s ease 0.5s forwards;
            color: #c4956d;
            font-style: italic;
            margin-bottom: 3rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }

        .memory-date {
            font-size: 1.2rem;
            color: #a0826d;
            opacity: 0;
            animation: fadeInUp 2s ease 1s forwards;
            margin-bottom: 3rem;
            letter-spacing: 3px;
        }

        .start-button {
            padding: 20px 60px;
            font-size: 1.4rem;
            background: linear-gradient(145deg, #8b7355, #6d5a44);
            border: 3px solid #d4a574;
            border-radius: 5px;
            color: #f5e6d3;
            cursor: pointer;
            opacity: 0;
            animation: fadeInUp 2s ease 1.5s forwards;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.8),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .start-button:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.9),
                0 0 30px rgba(212, 165, 116, 0.5);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                transform: translateY(40px);
            }
        }

        /* Main container */
        .main-container {
            opacity: 0;
            transition: opacity 1.5s ease;
            position: relative;
            z-index: 2;
        }

        .main-container.visible {
            opacity: 1;
        }

        /* Floating memories - optimized canvas */
        #memories-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* Scene container */
        .scene-container {
            position: relative;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 100px 20px;
        }

        /* Vintage paper card */
        .scene-card {
            max-width: 900px;
            width: 100%;
            background: 
                linear-gradient(145deg, #f5e6d3 0%, #e8d4b8 100%);
            border-radius: 5px;
            padding: 70px;
            border: 15px solid #8b7355;
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.9),
                inset 0 0 100px rgba(139, 115, 85, 0.1);
            position: relative;
            overflow: hidden;
            transform: translateY(50px);
            opacity: 0;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, opacity;
        }

        /* Paper texture */
        .scene-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIiB4PSIwIiB5PSIwIj48ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9Ii43NSIgc3RpdGNoVGlsZXM9InN0aXRjaCIgdHlwZT0iZnJhY3RhbE5vaXNlIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ic2F0dXJhdGUiIHZhbHVlcz0iMCIvPjwvZmlsdGVyPjxwYXRoIGQ9Ik0wIDBoMzAwdjMwMEgweiIgZmlsdGVyPSJ1cmwoI2EpIiBvcGFjaXR5PSIuMDUiLz48L3N2Zz4=');
            opacity: 0.3;
            pointer-events: none;
        }

        /* Worn edges */
        .scene-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 0 0 50px rgba(139, 115, 85, 0.3);
            pointer-events: none;
        }

        .scene-card.visible {
            transform: translateY(0);
            opacity: 1;
        }

        /* Chapter number - vintage stamp style */
        .chapter-number {
            font-size: 1rem;
            color: #8b4513;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 1.5rem;
            font-weight: 700;
            position: relative;
            display: inline-block;
            padding: 8px 20px;
            border: 3px double #8b4513;
            background: rgba(139, 69, 19, 0.1);
            transform: rotate(-2deg);
        }

        /* Scene title - handwritten style */
        .scene-title {
            font-size: 3.5rem;
            font-weight: 400;
            margin-bottom: 2.5rem;
            color: #4a3626;
            font-family: 'Georgia', serif;
            line-height: 1.3;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }

        .scene-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 0;
            width: 150px;
            height: 2px;
            background: linear-gradient(90deg, #8b7355 0%, transparent 100%);
        }

        /* Scene content - letter style */
        .scene-content {
            font-size: 1.3rem;
            line-height: 2.2;
            color: #3a2a1a;
            margin-bottom: 2.5rem;
            text-align: justify;
            font-family: 'Georgia', serif;
            position: relative;
            z-index: 1;
        }

        .scene-content .highlight {
            color: #8b4513;
            font-weight: 700;
            font-style: italic;
            position: relative;
            padding: 0 4px;
        }

        .scene-content .highlight::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 0;
            width: 100%;
            height: 8px;
            background: rgba(212, 165, 116, 0.3);
            z-index: -1;
        }

        /* Navigation - vintage buttons */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            gap: 20px;
        }

        .nav-btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            background: linear-gradient(145deg, #8b7355, #6d5a44);
            border: 2px solid #d4a574;
            border-radius: 3px;
            color: #f5e6d3;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Georgia', serif;
            letter-spacing: 1px;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.6),
                0 0 20px rgba(212, 165, 116, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Progress indicator - film strip style */
        .progress-indicator {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background: rgba(139, 115, 85, 0.4);
            transition: all 0.3s ease;
            border: 1px solid #8b7355;
        }

        .progress-dot.active {
            background: #8b4513;
            width: 35px;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.8);
        }

        /* Timeline - vintage style */
        .timeline {
            position: fixed;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 25px;
            padding: 20px 10px;
            background: rgba(20, 15, 10, 0.8);
            border: 2px solid #8b7355;
            border-radius: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 20px;
            bottom: 20px;
            width: 2px;
            background: linear-gradient(180deg, transparent, #d4a574, transparent);
            transform: translateX(-50%);
        }

        .timeline-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3a2a1a;
            border: 3px solid #8b7355;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            z-index: 1;
            box-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }

        .timeline-dot.active {
            background: #d4a574;
            border-color: #f5e6d3;
            box-shadow: 
                0 0 20px rgba(212, 165, 116, 0.8),
                0 0 40px rgba(212, 165, 116, 0.4);
            transform: scale(1.4);
        }

        .timeline-dot:hover:not(.active) {
            transform: scale(1.2);
            border-color: #d4a574;
        }

        .timeline-dot::after {
            content: attr(data-chapter);
            position: absolute;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            background: rgba(20, 15, 10, 0.95);
            padding: 8px 15px;
            border-radius: 3px;
            font-size: 0.9rem;
            color: #d4a574;
            border: 1px solid #8b7355;
            box-shadow: 0 5px 20px rgba(0,0,0,0.9);
            font-family: 'Georgia', serif;
        }

        .timeline-dot:hover::after {
            opacity: 1;
        }

        /* Final scene - aged photograph style */
        .final-scene {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 20px;
        }

        .final-message {
            text-align: center;
            max-width: 800px;
        }

        .final-title {
            font-size: 4.5rem;
            font-weight: 400;
            margin-bottom: 2.5rem;
            color: #4a3626;
            font-family: 'Georgia', serif;
            animation: gentlePulse 3s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .final-text {
            font-size: 1.4rem;
            line-height: 2.2;
            color: #3a2a1a;
            margin-bottom: 3rem;
            font-family: 'Georgia', serif;
        }

        .celebration-btn {
            padding: 20px 60px;
            font-size: 1.4rem;
            background: linear-gradient(145deg, #8b7355, #6d5a44);
            border: 3px solid #d4a574;
            border-radius: 5px;
            color: #f5e6d3;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'Georgia', serif;
            letter-spacing: 2px;
        }

        .celebration-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 15px 40px rgba(0,0,0,0.9),
                0 0 30px rgba(212, 165, 116, 0.6);
        }

        @keyframes gentlePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        /* Music control - vintage radio style */
        .music-control {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid #8b7355;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
        }

        .music-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(145deg, #8b7355, #6d5a44);
            border: 2px solid #d4a574;
            color: #f5e6d3;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(212, 165, 116, 0.5);
        }

        .music-control span {
            color: #d4a574;
            font-family: 'Georgia', serif;
            font-size: 0.95rem;
            letter-spacing: 1px;
        }

        /* Decorative corners */
        .corner-decoration {
            position: fixed;
            width: 100px;
            height: 100px;
            border: 3px solid #8b7355;
            opacity: 0.3;
            z-index: 5;
            pointer-events: none;
        }

        .corner-tl { top: 20px; left: 20px; border-right: none; border-bottom: none; }
        .corner-tr { top: 20px; right: 20px; border-left: none; border-bottom: none; }
        .corner-bl { bottom: 20px; left: 20px; border-right: none; border-top: none; }
        .corner-br { bottom: 20px; right: 20px; border-left: none; border-top: none; }

        /* NEW FEATURES STYLES - Optimized with better selectors */

        /* Photo Gallery */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .polaroid {
            background: white;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: rotate(var(--rotation));
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .polaroid:hover {
            transform: rotate(0) scale(1.05);
            z-index: 10;
        }

        .polaroid-img {
            width: 100%;
            height: 180px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-style: italic;
            object-fit: cover; /* For real images */
        }

        .polaroid-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 3px;
        }

        .polaroid-caption {
            text-align: center;
            margin-top: 10px;
            font-family: 'Georgia', serif;
            color: #333;
            font-size: 0.9rem;
        }

        /* Love Letter */
        .love-letter {
            position: relative;
            padding: 30px;
            background: #f9f3e9;
            border: 1px solid #d4a574;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 30px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .letter-content {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            color: #3a2a1a;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease;
        }

        .letter-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .seal {
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 60px;
            height: 60px;
            background: #8b4513;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        /* Interactive Birthday Cake */
        .birthday-cake {
            text-align: center;
            margin: 40px 0;
        }

        .cake {
            position: relative;
            width: 200px;
            height: 120px;
            margin: 0 auto 20px;
        }

        .cake-base {
            width: 180px;
            height: 60px;
            background: #f5a6a6;
            border-radius: 10px;
            margin: 0 auto;
            position: relative;
        }

        .cake-top {
            width: 160px;
            height: 40px;
            background: #ffcccc;
            border-radius: 50% 50% 0 0;
            margin: 0 auto;
            position: relative;
            top: -20px;
        }

        .candle {
            width: 10px;
            height: 30px;
            background: #ffd700;
            margin: 0 auto;
            position: relative;
            top: -40px;
        }

        .flame {
            width: 15px;
            height: 25px;
            background: #ff9900;
            border-radius: 50% 50% 20% 20%;
            margin: 0 auto;
            position: relative;
            top: -65px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .flame.active {
            opacity: 1;
            animation: flicker 0.5s infinite alternate;
        }

        @keyframes flicker {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        .make-wish-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #d4a574;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-family: 'Georgia', serif;
        }

        /* Memory Jar */
        .memory-jar {
            background: #f5e6d3;
            border: 2px solid #8b7355;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            position: relative;
            min-height: 200px;
        }

        .jar-top {
            width: 100%;
            height: 20px;
            background: #8b7355;
            border-radius: 50%;
            position: absolute;
            top: -10px;
            left: 0;
        }

        .memory {
            background: rgba(255,255,255,0.7);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #d4a574;
            font-family: 'Georgia', serif;
            color: #3a2a1a;
            opacity: 0;
            transform: translateY(10px);
            animation: floatUp 0.5s forwards;
        }

        @keyframes floatUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .add-memory-btn {
            margin-top: 15px;
            padding: 8px 15px;
            background: #8b7355;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Georgia', serif;
        }

        /* Countdown Timer */
        .countdown-timer {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: rgba(139, 115, 85, 0.1);
            border-radius: 10px;
        }

        .timer-display {
            font-size: 2.5rem;
            font-family: monospace;
            color: #8b4513;
            margin: 20px 0;
        }

        .timer-label {
            font-size: 1.2rem;
            color: #3a2a1a;
            margin-bottom: 10px;
        }

        /* Reasons I Love You */
        .reasons-generator {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: rgba(212, 165, 116, 0.1);
            border-radius: 10px;
        }

        .reason-display {
            font-size: 1.5rem;
            color: #8b4513;
            margin: 20px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Georgia', serif;
            font-style: italic;
        }

        .generate-reason-btn {
            padding: 10px 20px;
            background: #d4a574;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-family: 'Georgia', serif;
        }

        /* Chat Recreation */
        .chat-recreation {
            max-width: 500px;
            margin: 30px auto;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chat-header {
            background: #8b7355;
            color: white;
            padding: 15px;
            text-align: center;
            font-family: 'Georgia', serif;
        }

        .chat-messages {
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .message.you {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            font-family: 'Georgia', serif;
        }

        .message.me .message-content {
            background: #e6f7ff;
            color: #333;
        }

        .message.you .message-content {
            background: #d4a574;
            color: white;
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 5px;
            opacity: 0.7;
        }

        /* Promise Wall */
        .promise-wall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .promise-card {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-top: 4px solid #d4a574;
            font-family: 'Georgia', serif;
            color: #333;
            transition: transform 0.3s ease;
        }

        .promise-card:hover {
            transform: translateY(-5px);
        }

        .promise-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #8b7355;
        }

        .promise-text {
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Confetti canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
        }

        /* Mobile responsive - Optimized for performance */
        @media (max-width: 768px) {
            body {
                cursor: auto;
            }

            /* Opening scene mobile */
            .opening-title {
                font-size: 2.2rem;
                padding: 0 20px;
            }

            .opening-subtitle {
                font-size: 1.1rem;
                padding: 0 20px;
            }

            .memory-date {
                font-size: 1rem;
            }

            .start-button {
                padding: 15px 35px;
                font-size: 1rem;
            }

            /* Scene card mobile */
            .scene-card {
                padding: 30px 20px;
                border: 8px solid #8b7355;
                margin: 20px 10px;
            }

            .chapter-number {
                font-size: 0.85rem;
                padding: 6px 15px;
                letter-spacing: 2px;
            }

            .scene-title {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
            }

            .scene-title::after {
                width: 100px;
                bottom: -10px;
            }

            .scene-content {
                font-size: 1rem;
                line-height: 1.9;
                text-align: left;
            }

            /* Navigation mobile */
            .navigation {
                flex-direction: column;
                gap: 15px;
                margin-top: 2rem;
            }

            .nav-btn {
                width: 100%;
                padding: 12px 30px;
                font-size: 1rem;
                justify-content: center;
            }

            .progress-indicator {
                order: -1;
                width: 100%;
                justify-content: center;
            }

            .progress-dot {
                width: 10px;
                height: 10px;
            }

            .progress-dot.active {
                width: 25px;
            }

            /* Timeline mobile */
            .timeline {
                right: 10px;
                padding: 10px 6px;
                gap: 15px;
                top: 50%;
                transform: translateY(-50%);
            }

            .timeline-dot {
                width: 14px;
                height: 14px;
                border: 2px solid #8b7355;
            }

            .timeline-dot.active {
                transform: scale(1.2);
            }

            .timeline-dot::after {
                display: none;
            }

            /* Final scene mobile */
            .final-scene {
                padding: 40px 20px;
            }

            .final-title {
                font-size: 2.2rem;
                margin-bottom: 1.5rem;
            }

            .final-text {
                font-size: 1rem;
                line-height: 1.9;
                margin-bottom: 2rem;
            }

            .celebration-btn {
                padding: 15px 35px;
                font-size: 1rem;
                width: 100%;
                max-width: 300px;
            }

            /* Music control mobile */
            .music-control {
                bottom: 15px;
                left: 15px;
                padding: 10px 15px;
                gap: 10px;
            }

            .music-btn {
                width: 35px;
                height: 35px;
            }

            .music-control span {
                font-size: 0.85rem;
                display: none;
            }

            /* Hide decorative elements on mobile for perf */
            .photo-frame,
            .corner-decoration {
                display: none;
            }

            /* Scene container mobile */
            .scene-container {
                padding: 80px 10px 60px;
                min-height: 100vh;
            }

            /* New features mobile */
            .photo-gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .polaroid {
                padding: 8px;
            }

            .polaroid-img {
                height: 120px;
            }

            .timer-display {
                font-size: 1.8rem;
            }

            .reason-display {
                font-size: 1.2rem;
                min-height: 60px;
            }

            .promise-wall {
                grid-template-columns: 1fr;
            }

            /* Pause animations on mobile */
            body::before { animation-play-state: paused; }
            .opening-scene::before { animation-duration: 16s; } /* Slower */
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            .opening-title {
                font-size: 1.8rem;
            }

            .opening-subtitle {
                font-size: 1rem;
            }

            .scene-card {
                padding: 25px 15px;
                border: 6px solid #8b7355;
            }

            .scene-title {
                font-size: 1.5rem;
            }

            .scene-content {
                font-size: 0.95rem;
                line-height: 1.8;
            }

            .final-title {
                font-size: 1.8rem;
            }

            .final-text {
                font-size: 0.95rem;
            }

            .timeline {
                right: 5px;
                padding: 8px 5px;
                gap: 12px;
            }

            .timeline-dot {
                width: 12px;
                height: 12px;
            }

            /* New features mobile small */
            .photo-gallery {
                grid-template-columns: 1fr;
            }
        }

        /* Landscape mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .scene-container {
                padding: 40px 10px;
            }

            .opening-scene {
                padding: 20px;
            }

            .opening-title {
                font-size: 2rem;
                margin-bottom: 1rem;
            }

            .opening-subtitle {
                margin-bottom: 1.5rem;
            }

            .memory-date {
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Hidden Audio Element for Background Music (Placeholder - Replace src with real MP3) -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
        Your browser does not support the audio element.
    </audio>

    <div class="custom-cursor"></div>
    <canvas id="memories-canvas"></canvas>
    <canvas id="confetti-canvas"></canvas>

    <!-- Decorative corners -->
    <div class="corner-decoration corner-tl"></div>
    <div class="corner-decoration corner-tr"></div>
    <div class="corner-decoration corner-bl"></div>
    <div class="corner-decoration corner-br"></div>

    <!-- Photo frames -->
    <div class="photo-frame frame-left-1"></div>
    <div class="photo-frame frame-left-2"></div>
    <div class="photo-frame frame-left-3"></div>
    <div class="photo-frame frame-right-1"></div>
    <div class="photo-frame frame-right-2"></div>
    <div class="photo-frame frame-right-3"></div>

    <!-- Opening Scene -->
    <div class="opening-scene" id="opening">
        <h1 class="opening-title">Our Love Story</h1>
        <p class="opening-subtitle">A Journey Through Time</p>
        <p class="memory-date" id="memoryDate">2021 - 2025</p>
        <button class="start-button" id="startBtn">Open the Memory Box</button>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <div class="timeline" id="timeline"></div>

        <div class="music-control">
            <button class="music-btn" id="musicBtn" aria-label="Toggle music">
                <i class="fas fa-music"></i>
            </button>
            <span>Memories Soundtrack</span>
        </div>

        <div class="scene-container" id="sceneContainer"></div>
    </div>

    <script>
        const scenes = [
            {
                chapter: "Chapter 1",
                title: "The Beginning 🌟",
                content: `Four years ago, our paths crossed and my life changed forever. You weren't just a friend - you were <span class="highlight">my safe place</span>, my confidante, my reason to smile every single day.\n\nThose first two years of friendship were magical. Every conversation, every laugh, every moment we shared built a foundation so strong that nothing could ever shake it. You became the person I turned to when I was lost, and the first person I wanted to tell when I was happy.\n\nLittle did I know, my best friend would one day become <span class="highlight">my everything</span>.`
            },
            {
                chapter: "Chapter 2",
                title: "Friendship Blossoms 🌸",
                content: `We talked about everything and nothing. Late-night conversations that stretched into dawn, silly jokes that made us laugh until our stomachs hurt, dreams we shared under starry skies.\n\nYou showed me what true friendship meant. You were there through my ups and downs, celebrating my victories and comforting me through my struggles. <span class="highlight">You didn't just listen - you understood</span>.\n\nEvery moment with you felt like home. And slowly, without even realizing it, you became the most important person in my world.`
            },
            {
                chapter: "Chapter 3",
                title: "Love Begins 💖",
                content: `Two years ago, everything changed. The friendship that meant the world to me transformed into something even more beautiful - <span class="highlight">love</span>.\n\nI remember the nervousness, the excitement, the butterflies. My hands were shaking, my words stumbling, but your smile made everything perfect. That first date, that first hug, that first kiss - they're etched in my heart forever.\n\nYou taught me that love isn't just a feeling - it's a choice, an action, a home. And with you, I found <span class="highlight">my forever home</span>.`
            },
            {
                chapter: "Chapter 4",
                title: "Our Journey Together 🌈",
                content: `These two years of loving you have been the best of my life. Every laugh we've shared, every challenge we've faced together, every milestone we've celebrated - they've all made our bond stronger.\n\nYou make every day brighter just by being you. Your laugh is my favorite song, your smile is my favorite sunrise, and your presence is my favorite place to be. <span class="highlight">You are my everything</span>.\n\nWe've grown together, dreamed together, and built a love that I know will last forever. You're not just my girlfriend - you're my partner, my soulmate, my destiny.`
            },
            {
                chapter: "Chapter 5",
                title: "The Woman You Are ✨",
                content: `I am so incredibly proud of the woman you've become. Your strength, your kindness, your determination - they inspire me every single day.\n\nYou have a heart bigger than the world, a spirit that shines brighter than the stars, and a soul more beautiful than any sunset. <span class="highlight">You are extraordinary</span>.\n\nYou're brave when you feel scared, strong when you feel weak, and beautiful even when you can't see it yourself. I see it all, and I love every part of you.`
            },
            {
                chapter: "Chapter 6",
                title: "Today - Your 18th 🎂",
                content: `Today marks a new chapter in your life. You're 18 now, stepping into adulthood with grace, dreams, and endless possibilities ahead of you.\n\nThis isn't just a birthday - it's a celebration of <span class="highlight">you</span>. Of everything you are, everything you've overcome, and everything you're yet to become.\n\nI know you'll shine brighter than the sun, reach higher than the stars, and achieve everything you dream of. And I'll be right here, cheering you on every step of the way.`
            },
            {
                chapter: "Chapter 7",
                title: "My Promise to You 💍",
                content: `I promise to stand by you through every season of life. Through joy and tears, success and failure, sunshine and storms - <span class="highlight">you'll never face anything alone</span>.\n\nI promise to love you not just today, but every day for the rest of my life. To support your dreams, celebrate your victories, and hold your hand through every challenge.\n\nI promise that no matter where life takes us, my heart will always be yours. Because what we have isn't just love - <span class="highlight">it's forever</span>.`
            },
            {
                chapter: "Final",
                title: "Happy Birthday, My Love 💖",
                content: `Four years of knowing you has been a blessing. Two years of loving you has been a dream. And a lifetime with you will be paradise.\n\nYou are more than my girlfriend - you're my best friend, my inspiration, my angel, my forever. <span class="highlight">You are my everything</span>.\n\nHappy 18th Birthday, my darling. Thank you for choosing me, for loving me, for being you. I love you more than words can ever say, and I'll spend forever proving it with my heart.\n\nHere's to today, to tomorrow, and to forever. <span class="highlight">I love you endlessly</span>. 💖✨`
            }
        ];

        // NEW FEATURES DATA
        const photoGallery = [
            { caption: "Our first photo together", rotation: "-5deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📸</text></svg>" },
            { caption: "That amazing sunset", rotation: "3deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌅</text></svg>" },
            { caption: "Your beautiful smile", rotation: "-2deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>😊</text></svg>" },
            { caption: "Our favorite place", rotation: "4deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏞️</text></svg>" },
            { caption: "That silly moment", rotation: "-3deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>😂</text></svg>" },
            { caption: "Our anniversary", rotation: "2deg", img: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💑</text></svg>" }
        ];

        const loveLetter = `My Dearest Love,

As I write this letter, my heart overflows with emotions that words can barely capture. From the moment you entered my life, everything changed in the most beautiful way.

I remember our first conversation, how effortlessly we connected. Those late nights talking about everything and nothing. The way your laughter became my favorite sound. How your presence alone could brighten my darkest days.

You've shown me what true love means - not just in grand gestures, but in the quiet moments. The way you remember little things about me. How you support my dreams. The comfort of your embrace after a long day.

You are my safe harbor, my greatest adventure, and my home all at once. With you, I've discovered parts of myself I never knew existed. You inspire me to be better, to dream bigger, to love deeper.

No matter where life takes us, know that my love for you is constant and unwavering. You are, and will always be, the most beautiful part of my story.

Forever yours,
Your Love`;

        const memories = [
            "The first time we talked until sunrise",
            "That surprise birthday party you threw for me",
            "Our first date at the little café",
            "The way you laugh when you're truly happy",
            "That rainy day we spent watching movies",
            "Our first trip together to the mountains",
            "The way you look at me when you think I'm not noticing"
        ];

        const reasons = [
            "The way your eyes light up when you're excited",
            "How you always know exactly what to say to make me feel better",
            "Your incredible strength in facing challenges",
            "The sound of your laughter that fills my heart with joy",
            "How you make even ordinary moments feel magical",
            "Your kindness that touches everyone around you",
            "The way you believe in me even when I doubt myself",
            "How you remember the little things that matter to me",
            "Your passion for the things you love",
            "The comfort I feel just being near you"
        ];

        const chatMessages = [
            { sender: "me", text: "Hey, are you free to talk?", time: "8:15 PM" },
            { sender: "you", text: "Always for you! What's up?", time: "8:16 PM" },
            { sender: "me", text: "Just wanted to hear your voice. Miss you", time: "8:17 PM" },
            { sender: "you", text: "Aww, I miss you too! Can't wait to see you tomorrow", time: "8:18 PM" },
            { sender: "me", text: "Me neither! I have a surprise for you", time: "8:19 PM" },
            { sender: "you", text: "Really? Now I'm curious! Tell me more", time: "8:20 PM" },
            { sender: "me", text: "It's a secret! You'll find out tomorrow 😊", time: "8:21 PM" },
            { sender: "you", text: "You know I'm terrible with surprises! But okay, I'll wait", time: "8:22 PM" },
            { sender: "me", text: "Trust me, you'll love it. Goodnight, beautiful", time: "8:23 PM" },
            { sender: "you", text: "Goodnight, my love. Sweet dreams 💖", time: "8:24 PM" }
        ];

        const promises = [
            { icon: "🤝", text: "I promise to always be honest with you" },
            { icon: "💖", text: "I promise to love you more each day" },
            { icon: "👂", text: "I promise to always listen, even when we disagree" },
            { icon: "🤗", text: "I promise to be your safe place to fall" },
            { icon: "🌟", text: "I promise to support your dreams and ambitions" },
            { icon: "😊", text: "I promise to make you smile every day" },
            { icon: "🌧️", text: "I promise to stand by you through storms and sunshine" },
            { icon: "💫", text: "I promise to grow with you and cherish our journey" }
        ];

        let currentScene = 0;
        let isAudioPlaying = false;
        let memoriesAnimationId;
        let confettiTimeout;

        const opening = document.getElementById('opening');
        const mainContainer = document.getElementById('mainContainer');
        const startBtn = document.getElementById('startBtn');
        const sceneContainer = document.getElementById('sceneContainer');
        const timeline = document.getElementById('timeline');
        const musicBtn = document.getElementById('musicBtn');
        const cursor = document.querySelector('.custom-cursor');
        const memoryDate = document.getElementById('memoryDate');
        const bgMusic = document.getElementById('bgMusic');

        // Dynamic date update
        const currentYear = new Date().getFullYear();
        memoryDate.textContent = `2021 - ${currentYear}`;

        // Custom cursor
        document.addEventListener('mousemove', (e) => {
            if (cursor.style.display !== 'none') {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            }
        });

        document.addEventListener('mousedown', () => cursor.classList.add('active'));
        document.addEventListener('mouseup', () => cursor.classList.remove('active'));

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' && currentScene < scenes.length - 1) {
                nextScene();
            } else if (e.key === 'ArrowLeft' && currentScene > 0) {
                prevScene();
            }
        });

        // Floating memories animation - with pause on hidden
        function initMemories() {
            const canvas = document.getElementById('memories-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const memories = [];
            const symbols = ['♥', '★', '✿', '☆', '♡', '✦', '❀', '✧'];
            const colors = ['#d4a574', '#c4956d', '#a0826d', '#8b7355'];

            for (let i = 0; i < 30; i++) {
                memories.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    symbol: symbols[Math.floor(Math.random() * symbols.length)],
                    size: Math.random() * 20 + 15,
                    vx: (Math.random() - 0.5) * 0.3,
                    vy: (Math.random() - 0.5) * 0.3,
                    opacity: Math.random() * 0.4 + 0.1,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.02,
                    color: colors[Math.floor(Math.random() * colors.length)]
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                memories.forEach(m => {
                    m.x += m.vx;
                    m.y += m.vy;
                    m.rotation += m.rotationSpeed;

                    if (m.x < 0 || m.x > canvas.width) m.vx *= -1;
                    if (m.y < 0 || m.y > canvas.height) m.vy *= -1;

                    ctx.save();
                    ctx.translate(m.x, m.y);
                    ctx.rotate(m.rotation);
                    ctx.globalAlpha = m.opacity;
                    ctx.font = `${m.size}px Georgia`;
                    ctx.fillStyle = m.color;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(m.symbol, 0, 0);
                    ctx.restore();
                });

                memoriesAnimationId = requestAnimationFrame(animate);
            }

            animate();
        }

        // Pause animations when not visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                cancelAnimationFrame(memoriesAnimationId);
            } else {
                initMemories(); // Restart if needed
            }
        });

        // Start button
        startBtn.addEventListener('click', () => {
            opening.classList.add('hidden');
            setTimeout(() => {
                mainContainer.classList.add('visible');
                renderScene(0);
                createTimeline();
                initMemories();
            }, 1500);
        });

        // Create timeline with touch support
        function createTimeline() {
            timeline.innerHTML = '';
            scenes.forEach((scene, index) => {
                const dot = document.createElement('div');
                dot.className = 'timeline-dot';
                dot.dataset.chapter = scene.chapter;
                dot.setAttribute('aria-label', `Go to ${scene.chapter}`);
                if (index === 0) dot.classList.add('active');
                dot.addEventListener('click', () => renderScene(index));
                dot.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    renderScene(index);
                });
                timeline.appendChild(dot);
            });
        }

        // NEW FEATURE FUNCTIONS

        // Photo Gallery
        function createPhotoGallery() {
            const gallery = document.createElement('div');
            gallery.className = 'photo-gallery';
            
            photoGallery.forEach(photo => {
                const polaroid = document.createElement('div');
                polaroid.className = 'polaroid';
                polaroid.style.setProperty('--rotation', photo.rotation);
                
                const imgDiv = document.createElement('div');
                imgDiv.className = 'polaroid-img';
                const img = document.createElement('img');
                img.src = photo.img;
                img.alt = photo.caption;
                imgDiv.appendChild(img);
                
                const caption = document.createElement('div');
                caption.className = 'polaroid-caption';
                caption.textContent = photo.caption;
                
                polaroid.appendChild(imgDiv);
                polaroid.appendChild(caption);
                gallery.appendChild(polaroid);
            });
            
            return gallery;
        }

        // Love Letter
        function createLoveLetter() {
            const letterContainer = document.createElement('div');
            letterContainer.className = 'love-letter';
            
            const letterContent = document.createElement('div');
            letterContent.className = 'letter-content';
            letterContent.innerHTML = loveLetter.replace(/\n/g, '<br>');
            
            const seal = document.createElement('div');
            seal.className = 'seal';
            seal.innerHTML = '💌';
            
            letterContainer.appendChild(letterContent);
            letterContainer.appendChild(seal);
            
            // Animate letter appearance
            setTimeout(() => {
                letterContent.classList.add('visible');
            }, 500);
            
            return letterContainer;
        }

        // Interactive Birthday Cake - Fixed logic
        function createBirthdayCake() {
            const cakeContainer = document.createElement('div');
            cakeContainer.className = 'birthday-cake';
            
            cakeContainer.innerHTML = `
                <h3 style="color: #4a3626; margin-bottom: 20px;">Make a Wish! 🎂</h3>
                <div class="cake">
                    <div class="cake-base"></div>
                    <div class="cake-top"></div>
                    <div class="candle"></div>
                    <div class="flame active" id="cakeFlame"></div>
                </div>
                <button class="make-wish-btn" id="wishBtn">Blow Out the Candles</button>
            `;
            
            const wishBtn = cakeContainer.querySelector('#wishBtn');
            const flame = cakeContainer.querySelector('#cakeFlame');
            
            wishBtn.addEventListener('click', () => {
                if (flame.classList.contains('active')) {
                    flame.classList.remove('active');
                    wishBtn.textContent = "Light the Candles Again";
                    triggerConfetti();
                } else {
                    flame.classList.add('active');
                    wishBtn.textContent = "Blow Out the Candles";
                }
            });
            
            return cakeContainer;
        }

        // Memory Jar - With validation
        function createMemoryJar() {
            const jarContainer = document.createElement('div');
            jarContainer.className = 'memory-jar';
            
            const jarTop = document.createElement('div');
            jarTop.className = 'jar-top';
            
            const memoriesContainer = document.createElement('div');
            memoriesContainer.id = 'memoriesContainer';
            
            const addMemoryBtn = document.createElement('button');
            addMemoryBtn.className = 'add-memory-btn';
            addMemoryBtn.textContent = 'Add a Memory';
            addMemoryBtn.setAttribute('aria-label', 'Add a new memory');
            
            jarContainer.appendChild(jarTop);
            jarContainer.appendChild(memoriesContainer);
            jarContainer.appendChild(addMemoryBtn);
            
            // Add initial memories
            memories.forEach((memory, index) => {
                setTimeout(() => {
                    const memoryElement = document.createElement('div');
                    memoryElement.className = 'memory';
                    memoryElement.textContent = memory;
                    memoriesContainer.appendChild(memoryElement);
                }, index * 300);
            });
            
            addMemoryBtn.addEventListener('click', () => {
                const newMemory = prompt("Add a new memory:");
                if (newMemory && newMemory.trim().length > 0) {
                    const memoryElement = document.createElement('div');
                    memoryElement.className = 'memory';
                    memoryElement.textContent = newMemory.trim();
                    memoriesContainer.appendChild(memoryElement);
                } else if (newMemory) {
                    alert('Please enter a valid memory!');
                }
            });
            
            return jarContainer;
        }

        // Countdown Timer - Dynamic to Oct 6
        function createCountdownTimer() {
            const timerContainer = document.createElement('div');
            timerContainer.className = 'countdown-timer';
            
            let targetDate = new Date(2025, 9, 6); // Oct 6, 2025
            if (targetDate < new Date()) {
                targetDate.setFullYear(targetDate.getFullYear() + 1);
            }
            
            timerContainer.innerHTML = `
                <div class="timer-label">Until Our Anniversary 💕</div>
                <div class="timer-display" id="countdownDisplay">00:00:00:00</div>
                <div class="timer-label">Days : Hours : Minutes : Seconds</div>
            `;
            
            const countdownDisplay = timerContainer.querySelector('#countdownDisplay');
            
            function updateCountdown() {
                const now = new Date().getTime();
                const distance = targetDate - now;
                
                if (distance < 0) {
                    countdownDisplay.textContent = "Happy Anniversary! 🎉";
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                countdownDisplay.textContent = 
                    `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            return timerContainer;
        }

        // Reasons I Love You Generator
        function createReasonsGenerator() {
            const reasonsContainer = document.createElement('div');
            reasonsContainer.className = 'reasons-generator';
            
            reasonsContainer.innerHTML = `
                <h3 style="color: #4a3626; margin-bottom: 10px;">Reasons I Love You 💖</h3>
                <div class="reason-display" id="reasonDisplay">Click the button to see a reason!</div>
                <button class="generate-reason-btn" id="generateReasonBtn">Show Me Another Reason</button>
            `;
            
            const reasonDisplay = reasonsContainer.querySelector('#reasonDisplay');
            const generateBtn = reasonsContainer.querySelector('#generateReasonBtn');
            
            let currentReasonIndex = -1;
            
            function getRandomReason() {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * reasons.length);
                } while (newIndex === currentReasonIndex && reasons.length > 1);
                
                currentReasonIndex = newIndex;
                return reasons[currentReasonIndex];
            }
            
            generateBtn.addEventListener('click', () => {
                reasonDisplay.textContent = getRandomReason();
            });
            
            // Show first reason on load
            reasonDisplay.textContent = getRandomReason();
            
            return reasonsContainer;
        }

        // Chat Recreation
        function createChatRecreation() {
            const chatContainer = document.createElement('div');
            chatContainer.className = 'chat-recreation';
            
            let chatHTML = `
                <div class="chat-header">
                    <h3>Our Special Conversation 💬</h3>
                </div>
                <div class="chat-messages" id="chatMessages">
            `;
            
            chatMessages.forEach(message => {
                const messageClass = message.sender === 'me' ? 'me' : 'you';
                chatHTML += `
                    <div class="message ${messageClass}">
                        <div class="message-content">
                            ${message.text}
                            <div class="message-time">${message.time}</div>
                        </div>
                    </div>
                `;
            });
            
            chatHTML += `</div>`;
            
            chatContainer.innerHTML = chatHTML;
            
            // Auto-scroll to bottom
            const chatMessagesEl = chatContainer.querySelector('#chatMessages');
            chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
            
            return chatContainer;
        }

        // Promise Wall
        function createPromiseWall() {
            const wallContainer = document.createElement('div');
            wallContainer.className = 'promise-wall';
            
            promises.forEach(promise => {
                const promiseCard = document.createElement('div');
                promiseCard.className = 'promise-card';
                
                promiseCard.innerHTML = `
                    <div class="promise-icon">${promise.icon}</div>
                    <div class="promise-text">${promise.text}</div>
                `;
                
                wallContainer.appendChild(promiseCard);
            });
            
            return wallContainer;
        }

        // Render scene with lazy load for final
        function renderScene(index) {
            currentScene = index;
            const scene = scenes[index];
            sceneContainer.innerHTML = '';

            const card = document.createElement('div');
            card.className = 'scene-card';

            if (index === scenes.length - 1) {
                // Final scene with lazy load
                card.innerHTML = `
                    <div class="final-scene">
                        <div class="final-message">
                            <h1 class="final-title">${scene.title}</h1>
                            <div class="final-text">${scene.content}</div>
                            <div id="featuresContainer"></div>
                            <button class="celebration-btn" onclick="triggerConfetti()">
                                🎉 Celebrate This Moment 🎉
                            </button>
                        </div>
                    </div>
                `;
                sceneContainer.appendChild(card);
                setTimeout(() => card.classList.add('visible'), 100);

                // Lazy load features
                setTimeout(() => {
                    const featuresContainer = document.getElementById('featuresContainer');
                    featuresContainer.appendChild(createPhotoGallery());
                    setTimeout(() => featuresContainer.appendChild(createLoveLetter()), 300);
                    setTimeout(() => featuresContainer.appendChild(createBirthdayCake()), 600);
                    setTimeout(() => featuresContainer.appendChild(createMemoryJar()), 900);
                    setTimeout(() => featuresContainer.appendChild(createCountdownTimer()), 1200);
                    setTimeout(() => featuresContainer.appendChild(createReasonsGenerator()), 1500);
                    setTimeout(() => featuresContainer.appendChild(createChatRecreation()), 1800);
                    setTimeout(() => featuresContainer.appendChild(createPromiseWall()), 2100);
                }, 500);
            } else {
                card.innerHTML = `
                    <div class="chapter-number">${scene.chapter}</div>
                    <h2 class="scene-title">${scene.title}</h2>
                    <div class="scene-content">${scene.content.replace(/\n/g, '<br>')}</div>
                    <div class="navigation">
                        <button class="nav-btn" onclick="prevScene()" ${index === 0 ? 'disabled' : ''} aria-label="Previous chapter">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="progress-indicator">
                            ${scenes.map((_, i) => `<div class="progress-dot ${i === index ? 'active' : ''}"></div>`).join('')}
                        </div>
                        <button class="nav-btn" onclick="nextScene()" aria-label="Next chapter">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                `;
                sceneContainer.appendChild(card);
                setTimeout(() => card.classList.add('visible'), 100);
            }

            updateTimeline(index);
            sceneContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Update timeline
        function updateTimeline(index) {
            const dots = timeline.querySelectorAll('.timeline-dot');
            dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
        }

        // Global navigation functions
        window.nextScene = function() {
            if (currentScene < scenes.length - 1) renderScene(currentScene + 1);
        };

        window.prevScene = function() {
            if (currentScene > 0) renderScene(currentScene - 1);
        };

        // Music control - Now functional
        musicBtn.addEventListener('click', () => {
            isAudioPlaying = !isAudioPlaying;
            musicBtn.innerHTML = isAudioPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-music"></i>';
            if (isAudioPlaying) {
                bgMusic.play().catch(e => console.log('Audio play failed (check autoplay policy):', e));
            } else {
                bgMusic.pause();
            }
        });

        // Vintage confetti - With timeout
        window.triggerConfetti = function() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const confetti = [];
            const colors = ['#d4a574', '#c4956d', '#8b7355', '#a0826d', '#6d5a44'];
            const shapes = ['circle', 'square', 'triangle'];

            for (let i = 0; i < 200; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 8 + 4,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    shape: shapes[Math.floor(Math.random() * shapes.length)],
                    speed: Math.random() * 3 + 1.5,
                    angle: Math.random() * 360,
                    spin: Math.random() * 10 - 5,
                    opacity: Math.random() * 0.6 + 0.4
                });
            }

            function drawConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = 0;

                confetti.forEach(c => {
                    c.y += c.speed;
                    c.x += Math.sin(c.angle * Math.PI / 180) * 2;
                    c.angle += c.spin;

                    if (c.y < canvas.height) {
                        active++;
                        ctx.save();
                        ctx.translate(c.x, c.y);
                        ctx.rotate(c.angle * Math.PI / 180);
                        ctx.globalAlpha = c.opacity;
                        ctx.fillStyle = c.color;

                        if (c.shape === 'circle') {
                            ctx.beginPath();
                            ctx.arc(0, 0, c.size / 2, 0, Math.PI * 2);
                            ctx.fill();
                        } else if (c.shape === 'square') {
                            ctx.fillRect(-c.size / 2, -c.size / 2, c.size, c.size);
                        } else {
                            ctx.beginPath();
                            ctx.moveTo(0, -c.size / 2);
                            ctx.lineTo(c.size / 2, c.size / 2);
                            ctx.lineTo(-c.size / 2, c.size / 2);
                            ctx.closePath();
                            ctx.fill();
                        }

                        ctx.restore();
                    }
                });

                if (active > 0) requestAnimationFrame(drawConfetti);
            }

            drawConfetti();
            clearTimeout(confettiTimeout);
            confettiTimeout = setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }, 5000); // Stop after 5 seconds
        }

        // Resize handler
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('memories-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>